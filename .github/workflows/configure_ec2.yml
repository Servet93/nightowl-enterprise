name: Configure EC2

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Set up SSH
      run: |
        mkdir -p ~/.ssh/
        echo "EC2IP -> ${{ secrets.EC2_IP }}"
        echo "SSH_PRIVATE_KEY ->  ${{ secrets.EC2_SSH_PRIVATE_KEY }}"
        echo "${{ secrets.EC2_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ${{ secrets.EC2_IP }} >> ~/.ssh/known_hosts

    - name: Creating env variables and service file
      run: |
          ssh -i ~/.ssh/id_rsa ec2-user@${{ secrets.EC2_IP }} 'bash -s' << 'EOF'
            # Buraya inline komutlarınızı ekleyin
            export ASPNETCORE_URLS="${{ secrets.EC2_URL }}"
            # Daha fazla komut ekleyebilirsiniz
            echo -e "${{ vars.SERVICE_DEFINITON_CONTENT_ON_EC2 }}" | sudo tee /etc/systemd/system/nightowl-enterprise.service
          EOF
          
